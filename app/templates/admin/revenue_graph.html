{% extends "base_admin.html" %}
{% block title %}å£²ä¸Šæ¨ç§»ã‚°ãƒ©ãƒ•ï¼†CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">ğŸ“ˆ å£²ä¸Šæ¨ç§»ï¼ˆéå»12ãƒ¶æœˆï¼‰</h1>

<!-- âœ… ã‚°ãƒ©ãƒ• -->
<div class="bg-white p-6 rounded shadow mb-8">
  <canvas id="revenueChart" height="120"></canvas>
</div>

<!-- âœ… CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->
<div class="mb-6">
  <a href="{{ url_for('admin.download_revenue_log') }}"
     class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow">
    ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  </a>
</div>
<!-- ğŸ‘‡ JSONã‚’å±æ€§ã«å‡ºåŠ› -->
<div id="revenue-data"
     data-labels='{{ monthly_data | map(attribute="month") | map("string") | list | tojson }}'
     data-values='{{ monthly_data | map(attribute="total") | map("int") | list | tojson }}'>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const el = document.getElementById('revenue-data');
  const revenueLabels = JSON.parse(el.dataset.labels);
  const revenueValues = JSON.parse(el.dataset.values).map(v => v / 100);  // å††æ›ç®—

  const ctx = document.getElementById('revenueChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: revenueLabels,
      datasets: [{
        label: 'æœˆåˆ¥å£²ä¸Šï¼ˆå††ï¼‰',
        data: revenueValues,
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        tension: 0.3,
        fill: true,
        pointRadius: 5
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 10000 }
        }
      }
    }
  });
</script>
{% endblock %}
