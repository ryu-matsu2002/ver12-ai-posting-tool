{% extends "base_admin.html" %}
{% block title %}内部SEO プレビュー{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="h4 mb-3">🧪 内部SEO プレビュー <span class="text-muted">Site {{ site_id }} / Post {{ post_id }}</span></h2>

  <div class="alert alert-info">
    このページは <code>apply</code> を実行せず、<strong>見出し内リンク除去</strong>＋<strong>新仕様の仮適用</strong>結果を可視化します。
  </div>

  <div class="mb-3">
    <span class="badge bg-secondary me-2">applied: {{ result.applied }}</span>
    <span class="badge bg-secondary me-2">swapped: {{ result.swapped }}</span>
    <span class="badge bg-secondary me-2">skipped: {{ result.skipped }}</span>
    {% if result.message %}
      <span class="badge bg-info text-dark">message: {{ result.message }}</span>
    {% endif %}
  </div>

  {% if previews and previews|length > 0 %}
  <div class="list-group mb-4">
    {% for p in previews %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between">
          <div>
            <div class="fw-semibold">位置: {{ p.position }} / 段落Index: {{ p.paragraph_index }}</div>
            <div class="small text-muted">ターゲット: <a href="{{ p.target_url }}" target="_blank">{{ p.target_url }}</a> (post_id={{ p.target_post_id }})</div>
            <div class="small">アンカー: <span class="badge bg-primary">{{ p.anchor_text }}</span></div>
          </div>
        </div>
        <hr class="my-2">
        <div class="row">
          <div class="col-md-6">
            <div class="small text-muted">Before</div>
            <div class="border rounded p-2 bg-light">{{ p.paragraph_excerpt_before }}</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">After</div>
            <div class="border rounded p-2">{{ p.paragraph_excerpt_after }}</div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="text-muted">変化はありません（または pending がありません）。</div>
  {% endif %}

  <div>
    <a class="btn btn-outline-secondary" href="/admin/internal-seo" target="_self">← 管理画面へ戻る</a>
  </div>
</div>
{% endblock %}
