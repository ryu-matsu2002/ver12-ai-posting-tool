{% extends "base_admin.html" %}
{% block title %}
  {% if user %}
    {{ user.last_name }} {{ user.first_name }} ã•ã‚“ã®ç”Ÿæˆé€”ä¸­è¨˜äº‹ä¸€è¦§ | ç®¡ç†è€…
  {% else %}
    ç”Ÿæˆé€”ä¸­ã®è¨˜äº‹ä¸€è¦§ | ç®¡ç†è€…
  {% endif %}
{% endblock %}

{% block content %}

{% if user %}
  <h1 class="text-2xl font-bold mb-6">
    ğŸ›  {{ user.last_name }} {{ user.first_name }} ã•ã‚“ã®ç”Ÿæˆé€”ä¸­è¨˜äº‹ä¸€è¦§
  </h1>

  {% if articles %}
    <table class="table-auto w-full bg-white shadow rounded">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="px-4 py-2 text-left">è¨˜äº‹ID</th>
          <th class="px-4 py-2 text-left">ã‚¿ã‚¤ãƒˆãƒ«</th>
          <th class="px-4 py-2 text-center">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
          <th class="px-4 py-2 text-center">ä½œæˆæ—¥æ™‚</th>
        </tr>
      </thead>
      <tbody>
        {% for art in articles %}
        <tr class="border-t">
          <td class="px-4 py-2">{{ art.id }}</td>
          <td class="px-4 py-2">{{ art.title or "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®šï¼‰" }}</td>
          <td class="px-4 py-2 text-center text-yellow-600 font-semibold">{{ art.status }}</td>
          <td class="px-4 py-2 text-center">{{ art.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-gray-600">ç¾åœ¨ã€ç”Ÿæˆé€”ä¸­ã®è¨˜äº‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

  <div class="mt-6">
    <a href="{{ url_for('admin.all_stuck_users') }}"
       class="inline-block bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
      â† ä¸€è¦§ã«æˆ»ã‚‹
    </a>

  </div>

{% else %}
  <h1 class="text-2xl font-bold mb-6">ğŸ›  ç”Ÿæˆé€”ä¸­è¨˜äº‹ã®ç®¡ç†</h1>

  <table class="table-auto w-full bg-white shadow rounded">
    <thead class="bg-gray-100 text-gray-700">
      <tr>
        <th class="px-4 py-2 text-left">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
        <th class="px-4 py-2 text-left">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
        <th class="px-4 py-2 text-center">é€”ä¸­è¨˜äº‹æ•°</th>
        <th class="px-4 py-2 text-center">æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
        {% set count = stuck_map[user.id] %}
        <tr class="border-t">
          <td class="px-4 py-2">{{ user.last_name }} {{ user.first_name }}</td>
          <td class="px-4 py-2">{{ user.email }}</td>
          <td class="px-4 py-2 text-center font-bold text-red-600">{{ count }}</td>
          <td class="px-4 py-2 text-center space-x-2">
            {% if count > 0 %}
              <form method="POST" action="{{ url_for('admin.regenerate_user_stuck_articles', uid=user.id) }}" class="inline">
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded">
                  ğŸ”„ å†ç”Ÿæˆã‚­ãƒ¥ãƒ¼ã«ç™»éŒ²
                </button>
              </form>
              <a href="{{ url_for('admin.stuck_articles', uid=user.id) }}"
                 class="inline-block bg-gray-300 hover:bg-gray-400 text-gray-800 py-1 px-3 rounded">
                ğŸ‘ ä¸€è¦§è¡¨ç¤º
              </a>

            {% else %}
              <span class="text-gray-400">â€•</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
