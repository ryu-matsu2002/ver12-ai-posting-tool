{% extends "base_admin.html" %}
{% block title %}APIä½¿ç”¨é‡ / ãƒˆãƒ¼ã‚¯ãƒ³åˆ†æ{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">ğŸ§  APIä½¿ç”¨é‡ / ãƒˆãƒ¼ã‚¯ãƒ³åˆ†æ</h1>

<!-- âœ… æ¨ªä¸¦ã³2ã‚«ãƒ©ãƒ ï¼šã‚°ãƒ©ãƒ•ã¨è¡¨ -->
<div class="flex flex-col lg:flex-row gap-6">

  <!-- ğŸ“ˆ æ—¥åˆ¥ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ï¼ˆã‚°ãƒ©ãƒ•ï¼‰ -->
  <div class="bg-white p-4 rounded shadow w-full lg:w-1/2">
    <h2 class="text-lg font-semibold mb-2">ğŸ“… æ—¥åˆ¥ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ï¼ˆéå»30æ—¥ï¼‰</h2>
    <canvas id="dailyChart" height="60"></canvas>
  </div>

  <!-- ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ä½¿ç”¨é‡ -->
  <div class="bg-white p-4 rounded shadow w-full lg:w-1/2">
    <h2 class="text-lg font-semibold mb-2">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ï¼ˆéå»30æ—¥ï¼‰</h2>
    <table class="w-full table-auto text-sm">
      <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="p-2 text-left">ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
          <th class="p-2 text-left">ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³æ•°</th>
        </tr>
      </thead>
      <tbody>
        {% for email, tokens in user_data %}
        <tr class="border-b">
          <td class="p-2">{{ email }}</td>
          <td class="p-2">{{ tokens }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- ğŸ‘‡ JSONãƒ‡ãƒ¼ã‚¿ã‚’dataå±æ€§ä»˜ãã‚¿ã‚°ã«åŸ‹ã‚è¾¼ã‚€ -->
<div id="api-usage-data"
     data-labels='{{ daily_data | map(attribute="date") | map("string") | list | tojson }}'
     data-values='{{ daily_data | map(attribute="total_tokens") | list | tojson }}'>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const dataElem = document.getElementById('api-usage-data');
  const chartLabels = JSON.parse(dataElem.dataset.labels);
  const chartData = JSON.parse(dataElem.dataset.values);

  const ctx = document.getElementById('dailyChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartLabels,
      datasets: [{
        label: 'åˆè¨ˆãƒˆãƒ¼ã‚¯ãƒ³æ•°',
        data: chartData,
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 100
          }
        }
      }
    }
  });
</script>
{% endblock %}
