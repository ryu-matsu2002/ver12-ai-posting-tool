{% extends "base.html" %}
{% block title %}Search Console é€£æº | AI Posting Tool{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-6">ğŸ”— Search Console é€£æº</h2>

<!-- ğŸ” ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
<div class="mb-6 flex flex-wrap items-center gap-3 text-sm">
  <a href="{{ url_for('main.gsc_connect', status='all', query=search_query, order=order) }}"
     class="px-4 py-2 rounded border {{ 'bg-blue-600 text-white' if filter_status == 'all' or not filter_status else 'bg-white text-gray-700 hover:bg-gray-100' }}">
    ğŸ“‚ ã™ã¹ã¦
  </a>
  <a href="{{ url_for('main.gsc_connect', status='connected', query=search_query, order=order) }}"
     class="px-4 py-2 rounded border {{ 'bg-green-600 text-white' if filter_status == 'connected' else 'bg-white text-gray-700 hover:bg-gray-100' }}">
    âœ… é€£æºæ¸ˆã¿
  </a>
  <a href="{{ url_for('main.gsc_connect', status='unconnected', query=search_query, order=order) }}"
     class="px-4 py-2 rounded border {{ 'bg-yellow-500 text-white' if filter_status == 'unconnected' else 'bg-white text-gray-700 hover:bg-gray-100' }}">
    âŒ æœªé€£æº
  </a>
</div>

<!-- ğŸ” æ¤œç´¢ï¼‹ä¸¦ã³æ›¿ãˆãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="get" class="mb-6 flex flex-wrap items-center gap-4">
  <input type="hidden" name="status" value="{{ filter_status or 'all' }}">

  <input type="text"
         name="query"
         placeholder="ã‚µã‚¤ãƒˆåã¾ãŸã¯URLã§æ¤œç´¢"
         value="{{ search_query or '' }}"
         class="p-2 border rounded w-64">

  <select name="order" class="p-2 border rounded">
    <option value="">ğŸ“… ç™»éŒ²æ—¥ãŒæ–°ã—ã„é †</option>
    <option value="most_views" {{ 'selected' if order == 'most_views' }}>ğŸ‘ è¡¨ç¤ºå›æ•°ãŒå¤šã„é †</option>
    <option value="least_views" {{ 'selected' if order == 'least_views' }}>ğŸ‘ è¡¨ç¤ºå›æ•°ãŒå°‘ãªã„é †</option>
  </select>

  <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded text-sm">æ¤œç´¢</button>
</form>

{% if sites %}
  <div class="space-y-4">
    {% for site in sites %}
      <div class="p-4 bg-white dark:bg-gray-800 rounded shadow border flex justify-between items-center">
        <div>
          <h3 class="text-lg font-semibold">{{ site.name }}</h3>
          <p class="text-sm text-blue-600 break-all">{{ site.url }}</p>
          <p class="text-xs text-gray-500 mt-1">ğŸ‘ è¡¨ç¤ºå›æ•°: {{ site.impressions or 0 }}</p>
        </div>
        <div class="text-right space-y-1">
          {% if site.gsc_connected %}
            <div class="flex items-center justify-end gap-2">
              <a href="{{ url_for('main.gsc_generate') }}?site_id={{ site.id }}"
                 class="inline-block bg-lime-600 hover:bg-lime-700 text-white text-sm px-4 py-2 rounded">
                GSCç”Ÿæˆ
              </a>
              <span class="inline-block bg-green-600 text-white text-xs font-semibold px-3 py-1 rounded">
                âœ… GSCé€£æºæ¸ˆã¿
              </span>
            </div>
          {% else %}
            <form method="post" action="{{ url_for('main.connect_gsc', site_id=site.id) }}">
              <button type="submit"
                      class="inline-block bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded">
                ğŸ” Googleã«æ¥ç¶š
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-gray-500 mt-8">è©²å½“ã™ã‚‹ã‚µã‚¤ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>
{% endif %}
{% endblock %}
