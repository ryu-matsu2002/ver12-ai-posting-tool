{% set username = current_user.username if current_user.is_authenticated else None %}
<!doctype html>
<html lang="ja" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex, nofollow">
  <title>{% block title %}AI Posting Tool{% endblock %}</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com/3.4.4"></script>

  <!-- Google Fonts / Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Roboto', 'sans-serif']
          },
          colors: {
            primary: '#031f6f',
            primaryDark: '#02194e',
            primaryHover: '#2546b0',
            brandBlue: '#6495ed'
          }
        }
      }
    };
  </script>

  <style>
    .side { display: block; padding: .5rem 1.5rem; border-radius: 9999px }
    .side:hover { background: rgba(59, 130, 246, .07) }
    .active { font-weight: 600; background-color: rgba(191, 219, 254, .7) }

    /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî® */
    @keyframes zigzag {
      0% { transform: translateX(0) translateY(0) scaleX(1); }
      25% { transform: translateX(100px) translateY(20px) scaleX(1); }
      50% { transform: translateX(200px) translateY(0) scaleX(-1); }
      75% { transform: translateX(100px) translateY(-20px) scaleX(-1); }
      100% { transform: translateX(0) translateY(0) scaleX(1); }
    }

    .robot-walk {
      animation: zigzag 10s infinite linear;
    }
  </style>
</head>

<body class="h-screen flex overflow-hidden bg-primary text-white">
  <!-- ===== SIDEBAR ===== -->
  <aside class="w-60 shrink-0 h-full bg-primaryDark border-r border-gray-700 shadow-md flex flex-col">

    <!-- üîµ „É≠„Ç¥„Ç®„É™„Ç¢ -->
    <a href="{{ url_for('main.dashboard', username=username) }}"
       class="flex items-center justify-center flex-col py-4 px-3 bg-primaryDark border-b border-white/20 hover:bg-primaryHover transition">
      <img src="{{ url_for('static', filename='images/tcc_logo.png') }}"
           alt="Site Craft „É≠„Ç¥"
           class="w-14 h-14 mb-1 rounded-full shadow-md">
      <div class="text-white text-center leading-tight font-bold text-[15px]">
        Site<br>craft
      </div>
    </a>

    <!-- „É°„Éã„É•„Éº -->
    <nav class="flex-1 py-4 space-y-1 overflow-y-auto">
      <a href="{{ url_for('main.dashboard', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/dashboard') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">dashboard</span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
      </a>
      <a href="{{ url_for('main.log_sites', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/log') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">article</span>Ë®ò‰∫ãÁîüÊàê
      </a>
      <a href="{{ url_for('main.sites', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/sites') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">language</span>„Çµ„Ç§„ÉàÁôªÈå≤
      </a>
      <a href="{{ url_for('main.keywords', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/keywords') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">edit</span>„Ç≠„Éº„ÉØ„Éº„ÉâÁôªÈå≤
      </a>
      <a href="{{ url_for('main.prompts', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/prompts') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">notes</span>„Éó„É≠„É≥„Éó„ÉàÁôªÈå≤
      </a>
      <a href="{{ url_for('main.chatgpt', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/' + username + '/chatgpt') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">smart_toy</span>ChatGPT
      </a>
      {% if current_user.is_authenticated and current_user.is_admin %}
      <a href="{{ url_for('admin.admin_dashboard') }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full text-yellow-300 font-semibold">
        <span class="material-icons align-middle mr-2">admin_panel_settings</span>ÁÆ°ÁêÜËÄÖ„Éö„Éº„Ç∏
      </a>
      {% endif %}
      {% if current_user.is_authenticated and current_user.is_special_access %}
      <a href="{{ url_for('main.special_purchase', username=username) }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full text-yellow-400 font-semibold">
        <span class="material-icons align-middle mr-2">credit_card</span>TCCÂ∞ÇÁî®Ê±∫Ê∏à„Éö„Éº„Ç∏
      </a>
      {% endif %}
      <a href="{{ url_for('main.login') }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full {{ request.path.startswith('/login') and 'font-semibold bg-[#0f2fa6]' }}">
        <span class="material-icons align-middle mr-2">login</span>„É≠„Ç∞„Ç§„É≥
      </a>
      <a href="{{ url_for('main.logout') }}"
         class="block px-6 py-2 hover:bg-primaryHover rounded-r-full text-red-400">
        <span class="material-icons align-middle mr-2">logout</span>„É≠„Ç∞„Ç¢„Ç¶„Éà
      </a>
    </nav>

    <!-- „ÉÜ„Éº„ÉûÂàáÊõø -->
    <div class="px-6 py-4 flex items-center justify-between">
      <button onclick="toggleTheme()" class="material-icons text-gray-300">dark_mode</button>
    </div>
  </aside>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="flex-1 overflow-y-auto p-6 bg-white text-black relative">

    <!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†± -->
    <div class="flex justify-end mb-6">
      <div class="relative">
        <button id="userDropdownBtn"
                class="flex items-center gap-2 px-4 py-2 text-base font-semibold text-gray-700 dark:text-white bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-full focus:outline-none"
                onclick="toggleUserDropdown()">
          <span class="material-icons text-2xl">account_circle</span>
          {{ current_user.username }}
        </button>
        <div id="userDropdown"
             class="absolute right-0 mt-2 w-48 hidden bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded shadow-lg z-50">
          <a href="{{ url_for('main.profile', username=current_user.username) }}"
             class="block px-4 py-2 text-sm text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
            „Éó„É≠„Éï„Ç£„Éº„É´
          </a>
          <a href="{{ url_for('main.logout') }}"
             class="block px-4 py-2 text-sm text-red-600 hover:bg-red-100 dark:hover:bg-red-700 dark:hover:text-white">
            „É≠„Ç∞„Ç¢„Ç¶„Éà
          </a>
        </div>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2 mb-6">
          {% for cat, msg in messages %}
            <div class="p-3 rounded text-sm
              {{ 'bg-green-100 text-green-800' if cat=='success' else 'bg-red-100 text-red-800' }}">
              {{ msg }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- üîÅ „É≠„Éú„ÉÉ„ÉàÊ≠©Ë°å„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
    <div class="relative h-40 w-full overflow-hidden mb-6">
      <img src="{{ url_for('static', filename='images/SITE CRAFTÂÖ¨Âºè„Ç≠„É£„É©Âè≥Âêë„Åç.png') }}"
           alt="„É≠„Éú„ÉÉ„Éà"
           class="w-24 h-24 absolute top-0 left-0 robot-walk">
    </div>

    {% block content %}{% endblock %}
  </main>

  <script>
    function toggleUserDropdown() {
      const menu = document.getElementById('userDropdown');
      menu.classList.toggle('hidden');
    }

    document.addEventListener('click', function (e) {
      const btn = document.getElementById('userDropdownBtn');
      const menu = document.getElementById('userDropdown');
      if (!btn.contains(e.target) && !menu.contains(e.target)) {
        menu.classList.add('hidden');
      }
    });

    function toggleTheme() {
      document.documentElement.classList.toggle("dark");
    }
  </script>
</body>
</html>
