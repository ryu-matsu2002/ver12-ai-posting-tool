{# app/templates/external_articles.html #}
{% extends "base.html" %}
{% block title %}å¤–éƒ¨SEO | è¨˜äº‹ä¸€è¦§{% endblock %}

{% block content %}
<style>
  :root{
    --seo-bg:#3A1F5C; --pane:#44286D; --pane-2:#4D2F7D; --edge:rgba(255,255,255,.14);
    --txt:#fff; --txt-dim:#E7E1FA; --row:#54307EAA; --row-alt:#593587AA; --row-hover:#68449C;
  }

  /* èƒŒæ™¯ã¨æ–‡å­—è‰²ã‚’å¤–éƒ¨SEOãƒšãƒ¼ã‚¸ã¨çµ±ä¸€ */
  html, body, main, #main, #content, .content, .page-wrapper, .page-content{
    background:var(--seo-bg) !important; color:var(--txt) !important;
  }
  h2, h3, p, th, td, a, span{ color:var(--txt) !important; }
  a{ color:#C9B7FF !important; } a:hover{ color:#fff !important; text-decoration:underline; }

  /* ãƒ†ãƒ¼ãƒ–ãƒ« */
  table{
    width:100%;
    border-collapse:separate; border-spacing:0;
    background:var(--pane); border:1px solid var(--edge);
    border-radius:12px; overflow:hidden; table-layout:fixed;
  }
  thead{ background:var(--pane-2) !important; }
  th{
    font-weight:700; padding:10px 12px; border-bottom:1px solid var(--edge);
    text-align:left; white-space:nowrap;
  }
  td{ padding:10px 12px; vertical-align:middle; }
  tbody tr{ background:var(--row); border-bottom:1px solid var(--edge); }
  tbody tr:nth-child(odd){ background:var(--row-alt); }
  tbody tr:hover{ background:var(--row-hover); }

  /* åˆ—å¹…ï¼ˆå³ç«¯ã®è¦‹åˆ‡ã‚Œé˜²æ­¢ã€‚æ“ä½œã¯å·¦å¯„ã›ãƒ»wrapå¯ï¼‰ */
  .col-key{ width:26%; }
  .col-state{ width:10%; }
  .col-date{ width:12%; }
  .col-title{ width:30%; }
  .col-actions{ width:22%; }  /* å³ç«¯ã«ä½™ç™½ãŒæ®‹ã‚Šã‚„ã™ã„ãƒãƒ©ãƒ³ã‚¹ */

  /* ã‚¿ã‚¤ãƒˆãƒ«åˆ—ï¼šé•·æ–‡ã¯çœç•¥è¡¨ç¤º */
  .title-ellipsis{
    overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }

  /* çŠ¶æ…‹ãƒãƒƒã‚¸ */
  .state-badge{ font-weight:600; }
  .state-posted{ background:#16A34A; color:#fff; }  /* æŠ•ç¨¿å®Œäº† */
  .state-done{   background:#2563EB; color:#fff; }  /* è¨˜äº‹ç”Ÿæˆæ¸ˆã¿ */
  .state-gen{    background:#D97706; color:#fff; }  /* è¨˜äº‹ç”Ÿæˆä¸­ */
  .state-error{  background:#DC2626; color:#fff; }  /* ã‚¨ãƒ©ãƒ¼ */

  /* ãƒœã‚¿ãƒ³ï¼ˆç™½æ–‡å­—ã§çµ±ä¸€ï¼‰ */
  .btn{ display:inline-flex; align-items:center; padding:.25rem .5rem; border-radius:.375rem;
        font-size:.75rem; line-height:1; color:#fff !important; }
  .btn-amber{ background:#D97706; }   .btn-amber:hover{ background:#F59E0B; }
  .btn-rose{  background:#DC2626; }   .btn-rose:hover{  background:#EF4444; }
  .btn-blue{  background:#2563EB; }   .btn-blue:hover{  background:#3B82F6; }
  .btn-emer{  background:#059669; }   .btn-emer:hover{  background:#10B981; }
  .btn-disabled{ opacity:.5; pointer-events:none; }

  /* æ“ä½œãƒœã‚¿ãƒ³è¡Œï¼šæŠ˜ã‚Šè¿”ã—OKã€å·¦å¯„ã›ï¼ˆå³ç«¯è¦‹åˆ‡ã‚Œé˜²æ­¢ï¼‰ */
  .actions{ display:flex; flex-wrap:wrap; gap:.35rem; justify-content:flex-start; }
</style>

<h2 class="text-2xl font-bold mb-6 flex items-center">
  ğŸ“ {{ site.name }} â€”
  <span class="ml-2 px-2 py-0.5 rounded text-white text-xs {% if acct.blog_type.value == 'livedoor' %}bg-orange-600{% elif acct.blog_type.value == 'note' %}bg-blue-600{% else %}bg-gray-600{% endif %}">
    {{ acct.blog_type.value }}
  </span>
  ã®è¨˜äº‹ä¸€è¦§
</h2>

<p class="mb-4">
  <a href="{{ url_for('main.external_accounts', site_id=site.id) }}">â† ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ã«æˆ»ã‚‹</a>
</p>

<table class="w-full text-sm">
  <colgroup>
    <col class="col-key">
    <col class="col-state">
    <col class="col-date">
    <col class="col-title">
    <col class="col-actions">
  </colgroup>
  <thead>
    <tr>
      <th class="px-3 py-2">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</th>
      <th class="px-3 py-2">ç¾åœ¨ã®çŠ¶æ…‹</th>
      <th class="px-3 py-2">æŠ•ç¨¿äºˆå®šæ—¥</th>
      <th class="px-3 py-2">Q&amp;Aè¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«</th>
      <th class="px-3 py-2">æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for sched, kw, art in rows %}
      {# è¡¨ç¤ºURL #}
      {% set view_url = sched.posted_url or (art and art.posted_url) or None %}

      {# çŠ¶æ…‹ #}
      {% set state = 'è¨˜äº‹ç”Ÿæˆä¸­' %}
      {% if view_url %}
        {% set state = 'æŠ•ç¨¿å®Œäº†' %}
      {% elif sched.status == 'posted' %}
        {% set state = 'æŠ•ç¨¿å®Œäº†' %}
      {% elif sched.status == 'error' or (art and art.status == 'error') %}
        {% set state = 'ã‚¨ãƒ©ãƒ¼' %}
      {% elif art %}
        {% if art.status in ['done'] %}
          {% set state = 'è¨˜äº‹ç”Ÿæˆæ¸ˆã¿' %}
        {% else %}
          {% set state = 'è¨˜äº‹ç”Ÿæˆä¸­' %}
        {% endif %}
      {% endif %}

      {% set badge_class =
         'state-posted' if state == 'æŠ•ç¨¿å®Œäº†' else
         'state-done'   if state == 'è¨˜äº‹ç”Ÿæˆæ¸ˆã¿' else
         'state-gen'    if state == 'è¨˜äº‹ç”Ÿæˆä¸­' else
         'state-error' %}

      <tr>
        <td class="px-3 py-2">{{ kw.keyword }}</td>
        <td class="px-3 py-2">
          <span class="px-2 py-1 rounded text-xs state-badge {{ badge_class }}">{{ state }}</span>
        </td>
        <td class="px-3 py-2">
          {% if sched.scheduled_date %}{{ to_jst(sched.scheduled_date).strftime("%Y-%m-%d %H:%M") }}{% endif %}
        </td>
        <td class="px-3 py-2 title-ellipsis" title="{{ art.title if art else '' }}">
          {{ art.title if art else "" }}
        </td>
        <td class="px-3 py-2">
          <div class="actions">
            {# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒœã‚¿ãƒ³ï¼‰ #}
            {% if art %}
              <a class="btn btn-blue"
                 href="{{ url_for('main.external_article_preview', article_id=art.id) }}" target="_blank">
                ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
              </a>
            {% else %}
              <span class="btn btn-blue btn-disabled">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
            {% endif %}

            {# æŠ•ç¨¿å®Œäº†æ™‚ã®ã€Œè¨˜äº‹è¡¨ç¤ºã€ #}
            {% if state == 'æŠ•ç¨¿å®Œäº†' %}
              {% if view_url %}
                <a class="btn btn-blue" href="{{ view_url }}" target="_blank">è¨˜äº‹è¡¨ç¤º</a>
              {% elif art %}
                <a class="btn btn-blue" href="{{ url_for('main.external_article_preview', article_id=art.id) }}" target="_blank">è¨˜äº‹è¡¨ç¤º</a>
              {% endif %}
            {% else %}
              <form action="{{ url_for('main.external_schedule_post_now', schedule_id=sched.id) }}" method="post">
                <button type="submit" class="btn btn-emer">å³æ™‚æŠ•ç¨¿</button>
              </form>
            {% endif %}

            {# ç·¨é›†/å‰Šé™¤ #}
            <a href="{{ url_for('main.external_article_edit', article_id=art.id) if art else '#' }}"
               class="btn btn-amber {% if not art %}btn-disabled{% endif %}">
              ç·¨é›†
            </a>

            <form action="{{ url_for('main.external_article_delete', article_id=art.id) if art else '#' }}"
                  method="post"
                  onsubmit="return confirm('ã“ã®è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
              <button type="submit" class="btn btn-rose {% if not art %}btn-disabled{% endif %}">
                å‰Šé™¤
              </button>
            </form>
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
