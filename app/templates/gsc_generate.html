{% extends "base.html" %}
{% block title %}GSCè¨˜äº‹ç”Ÿæˆ | Site Craft{% endblock %}

{% block content %}
<h2 class="text-3xl font-bold mb-8">ğŸ” GSCè¨˜äº‹ç”Ÿæˆ</h2>

<div class="grid md:grid-cols-2 gap-10 items-start">

  <!-- å·¦ã‚«ãƒ©ãƒ ï¼šã‚µã‚¤ãƒˆé¸æŠã¨ç”Ÿæˆé–‹å§‹ -->
  <div>
    <form id="gsc-form" method="GET">
      <div class="mb-6">
        <label class="block font-semibold mb-1 text-gray-800 dark:text-white">å¯¾è±¡ã‚µã‚¤ãƒˆ</label>
        <select id="gsc-site-id" name="site_id" class="w-full p-2 border rounded">
          {% for site in gsc_sites %}
            <option value="{{ site.id }}" {% if selected_site and selected_site.id == site.id %}selected{% endif %}>
              {{ site.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <p class="mb-4 text-gray-600 dark:text-gray-300">
        é¸æŠã—ãŸã‚µã‚¤ãƒˆã«å¯¾ã—ã¦ã€Search Consoleã‹ã‚‰æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å–å¾—ã—ã€è‡ªå‹•ã§è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™ã€‚
      </p>

      <button type="button"
              onclick="startGSCGeneration()"
              class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">
        ğŸ” GSCãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹
      </button>
    </form>
  </div>

  <!-- å³ã‚«ãƒ©ãƒ ï¼šæ—¢å­˜ã®GSCç”±æ¥ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆå‚è€ƒï¼‰ -->
  <div>
    <h3 class="text-xl font-semibold mb-4">ğŸ”– ç¾åœ¨ã®GSCã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§</h3>
    {% if gsc_keywords %}
      <ul class="bg-white dark:bg-gray-800 border rounded shadow divide-y max-h-[400px] overflow-y-auto">
        {% for kw in gsc_keywords %}
          <li class="p-3 flex justify-between items-center">
            <span>{{ kw.keyword }}</span>
            <span class="text-sm text-gray-500">
              {{ "ç”Ÿæˆæ¸ˆã¿" if kw.used else "æœªç”Ÿæˆ" }}
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-gray-500">ã¾ã GSCç”±æ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>
</div>

<!-- JS -->
<script>
  function startGSCGeneration() {
    const siteId = document.getElementById("gsc-site-id").value;
    if (!siteId) {
      alert("å¯¾è±¡ã‚µã‚¤ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
      return;
    }
    if (confirm("Search Consoleãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨˜äº‹ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ")) {
      window.location.href = `/generate_from_gsc/${siteId}`;
    }
  }
</script>
{% endblock %}
