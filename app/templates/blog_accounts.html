{# app/templates/blog_accounts.html #}
{% extends "base.html" %}
{% block title %}å¤–éƒ¨ãƒ–ãƒ­ã‚°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-6">ğŸ“ å¤–éƒ¨ãƒ–ãƒ­ã‚°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§</h2>

{% if accts %}
<table class="w-full text-sm">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-3 py-2">ãƒ–ãƒ­ã‚°</th>      {# note / hatena â€¦ #}
      <th class="px-3 py-2">ã‚µã‚¤ãƒˆ</th>      {# å¯¾è±¡ã‚µã‚¤ãƒˆã‚’è¿½åŠ  â˜… #}
      <th class="px-3 py-2">ãƒ¡ãƒ¼ãƒ«</th>
      <th class="px-3 py-2">æŠ•ç¨¿æ¸ˆ</th>
      <th class="px-3 py-2">äºˆå®š</th>
      <th class="px-3 py-2">é€²æ—</th>
      <th class="px-3 py-2">æœ€çµ‚æŠ•ç¨¿</th>
      <th class="px-3 py-2">è©³ç´°</th>
      <th class="px-3 py-2 text-right">æ“ä½œ</th>
    </tr>
  </thead>

  <tbody>
  {% for a in accts %}
    {% set scheduled = a.schedules|length %}
    {% set posted    = a.posted_cnt %}
    {% set pct       = (100 * posted / (scheduled if scheduled else 1)) | round(1) %}

    <tr class="border-b">
      {# â”€â”€ ãƒ–ãƒ­ã‚°ç¨®åˆ¥ãƒãƒƒã‚¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2">
        <span class="px-2 py-1 rounded text-white text-xs
              {% if a.blog_type.value == 'note' %} bg-blue-600
              {% elif a.blog_type.value == 'blogger' %} bg-orange-600
              {% else %} bg-gray-600 {% endif %}">
          {{ a.blog_type.value }}
        </span>
      </td>

      {# â”€â”€ å¯¾è±¡ã‚µã‚¤ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2">
        {% if a.site %}
          <a href="{{ a.site.url }}" class="text-blue-600 hover:underline" target="_blank">
            {{ a.site.name }}
          </a>
        {% else %}
          -
        {% endif %}
      </td>

      {# â”€â”€ ãƒ¡ãƒ¼ãƒ«ï¼ˆè¤‡åˆåŒ–ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2 font-mono max-w-[220px] truncate">
        {{ decrypt(a.email) }}
      </td>

      {# â”€â”€ æŠ•ç¨¿æ¸ˆãƒ»äºˆå®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2 text-center">{{ posted }}</td>
      <td class="px-3 py-2 text-center">{{ scheduled }}</td>

      {# é€²æ—ãƒãƒ¼ #}
      <td class="px-3 py-2 w-40">
        <div class="w-full bg-gray-200 h-2 rounded">
          <div class="bg-emerald-600 h-2 rounded
                      w-[calc({{ (100 * posted / (scheduled if scheduled else 1)) | round(1) }}%)]
          </div>
        </div>
      </td>

      {# â”€â”€ æœ€çµ‚æŠ•ç¨¿æ—¥æ™‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2">
        {{ a.updated_at.strftime('%Y-%m-%d %H:%M') if a.updated_at else '-' }}
      </td>

      {# â”€â”€ è©³ç´°ï¼ˆè¨˜äº‹ä¸€è¦§ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2">
        <a href="{{ url_for('main.external_account_articles', acct_id=a.id) }}"
           class="text-blue-600 hover:underline">è¨˜äº‹ä¸€è¦§</a>
      </td>

      {# â”€â”€ æ“ä½œï¼šãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°ã‚¤ãƒ³ / IDã‚³ãƒ”ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€ #}
      <td class="px-3 py-2 text-right">
        <form action="{{ url_for('main.blog_one_click_login', acct_id=a.id) }}"
              method="get" class="inline">
          <button type="submit"
                  class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs">
            ãƒ­ã‚°ã‚¤ãƒ³
          </button>
        </form>

        <button type="button"
                class="ml-2 px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-xs copy-cred"
                data-user="{{ a.username }}"
                data-pass="{{ decrypt(a.password) }}">
          ID/Pass
        </button>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<script>
document.querySelectorAll('.copy-cred').forEach(btn => {
  btn.addEventListener('click', () => {
    const u = btn.dataset.user;
    const p = btn.dataset.pass;
    navigator.clipboard.writeText(`ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ${u}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${p}`);
    btn.textContent = "âœ” ã‚³ãƒ”ãƒ¼";
    setTimeout(() => btn.textContent = "ID/Pass", 1500);
  });
});
</script>

{% else %}
<p class="text-gray-500">ã¾ã å¤–éƒ¨ãƒ–ãƒ­ã‚°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
{% endif %}
{% endblock %}
